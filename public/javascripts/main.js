
const SCROLL_RIGHT = 0;
const SCROLL_DOWN = 1;
const SCROLL_LEFT = 2;
const SCROLL_UP = 3;
const SCROLL_RANDOM = 4;

var panels = [];
var index = 0;

var scrollDirection = 0;
var isScrolling = false;

function newPanel(panelID, complete = function(){}){

    let used = new Set([]);
    for(let i in panels){
        used.add(panels[i].id);
    }

    $.get("/library/", {"used":JSON.stringify(Array.from(used))}, function(data){
        let s = data.indexOf("<!--");
        let e = data.indexOf("-->");

        let id = data.slice(s+4,e);
        console.log(id);

        $(panelID).html(data);

        panels.push({
            id: id, 
            scrollDirection: Math.floor(Math.random() * 4),
            html: $(panelID).html()
        });

        complete();
    });
}


function generateScroll(atEnd = false){
    //scrollDirection = Math.floor(Math.random() * 4);
    // scrollDirection = SCROLL_UP;
    $(".cont").removeClass("cont-down cont-left cont-right cont-up");
    $(".item").removeClass("item-down item-left item-right item-up");
    $(".scroll-cont").removeClass("scroll-cont-down scroll-cont-left scroll-cont-right scroll-cont-up");
    switch(scrollDirection){
        case SCROLL_RIGHT:
            $(".cont").addClass("cont-right");
            $(".item").addClass("item-right");
            $(".scroll-cont").addClass("scroll-cont-right");
            $(".scroll-cont").scrollLeft((atEnd) ? $(".item").width() : 0);
            break;
        case SCROLL_DOWN:
            $(".cont").addClass("cont-down");
            $(".item").addClass("item-down");
            $(".scroll-cont").addClass("scroll-cont-down");
            $(".scroll-cont").scrollTop((atEnd) ? $(".item").height() : 0);
            break;
        case SCROLL_LEFT:
            $(".cont").addClass("cont-left");
            $(".item").addClass("item-left");
            $(".scroll-cont").addClass("scroll-cont-left");
            $(".scroll-cont").scrollLeft((atEnd) ? 0 : $(".item").width());
            break;
        case SCROLL_UP:
            $(".cont").addClass("cont-up");
            $(".item").addClass("item-up");
            $(".scroll-cont").addClass("scroll-cont-up");
            $(".scroll-cont").scrollTop((atEnd) ? 0 : $(".item").height());
            break;

    }
}

$(document).ready(function(){

    //Create initial page
    newPanel("#item-1", function(){ 
        scrollDirection = panels[index].scrollDirection;
        generateScroll();
        newPanel("#item-2");
    });

    //Scroll event
    $(".scroll-cont").bind('mousewheel DOMMouseScroll', function(e){
        if(isScrolling) return false;

        let scrollAmount = e.originalEvent.wheelDelta;

        let scrollContent = $(".scroll-cont");

        let atMaxFunc = function(){
            if(panels[index+1].id != "end_panel"){
                index++;
                
                scrollDirection = panels[index].scrollDirection;
                generateScroll();
    
                $("#item-1").html(panels[index].html);
                if(index + 1 >= panels.length){
                    newPanel("#item-2");
                }else{
                    $("#item-2").html(panels[index + 1].html);
                }
            }
        };

        let atMinFunc = function(){
            index--;

            scrollDirection = panels[index].scrollDirection;
            generateScroll(true);

            $("#item-1").html(panels[index].html);
            $("#item-2").html(panels[index + 1].html);
        }

        //Change Scroll Animation Settings in this funciton
        let scrollAnimateFunc = function(arg, finish){
            isScrolling = true;
            scrollContent.animate(arg, 500, "swing", function(){
                isScrolling = false;
                finish();
            });
        };

        //Change Panel Prior if needed
        if(scrollAmount > 0){
            switch(scrollDirection){
                case SCROLL_RIGHT:
                    if(scrollContent.scrollLeft() == 0 && index > 0)
                        atMinFunc();
                    break;
                case SCROLL_DOWN:
                    if(scrollContent.scrollTop() == 0 && index > 0)
                        atMinFunc();
                    break;
                case SCROLL_LEFT:
                    if(scrollContent.scrollLeft() > 0 && index > 0)
                        atMinFunc();
                    break;
                case SCROLL_UP:
                    if(scrollContent.scrollTop() > 0 && index > 0)
                        atMinFunc();
                    break;
    
            }
        }

        //Animate Scroll
        switch(scrollDirection){
            case SCROLL_RIGHT:
                if(scrollAmount > 0){
                    if(scrollContent.scrollLeft() > 0){
                        scrollAnimateFunc({
                            scrollLeft: 0
                        },function(){});
                    }
                }else if(scrollAmount < 0){
                    if(scrollContent.scrollLeft() == 0){
                        scrollAnimateFunc({
                            scrollLeft: scrollContent.width()
                        }, function(){
                            atMaxFunc();
                        });
                    }
                }
                break;
            case SCROLL_DOWN:
                if(scrollAmount > 0){
                    if(scrollContent.scrollTop() > 0){
                        scrollAnimateFunc({
                            scrollTop: 0
                        },function(){});
                    }
                }else if(scrollAmount < 0){
                    if(scrollContent.scrollTop() == 0){
                        scrollAnimateFunc({
                            scrollTop: scrollContent.height()
                        }, function(){
                            atMaxFunc();
                        });
                    }
                }
                break;
            case SCROLL_LEFT:
                if(scrollAmount > 0){
                    if(scrollContent.scrollLeft() == 0){
                        scrollAnimateFunc({
                            scrollLeft: scrollContent.width()
                        },function(){});
                    }
                }else if(scrollAmount < 0){
                    if(scrollContent.scrollLeft() > 0){
                        scrollAnimateFunc({
                            scrollLeft: 0
                        }, function(){
                            atMaxFunc();
                        });
                    }
                }
                break;
            case SCROLL_UP:
                if(scrollAmount > 0){
                    if(scrollContent.scrollTop() == 0){
                        scrollAnimateFunc({
                            scrollTop: scrollContent.height()
                        },function(){});
                    }
                }else if(scrollAmount < 0){
                    if(scrollContent.scrollTop() > 0){
                        scrollAnimateFunc({
                            scrollTop: 0
                        }, function(){
                            atMaxFunc();
                        });
                    }
                }
                break;

        }
        return false;
    });
});

